<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sensor Config</title>
</head>
<body>
  <h2>Sensor Config</h2>
  <form action="/save2" method="POST">
    <label for="mesh">MESH ID (decimal):</label>
    <input name="mesh" id="mesh"><br><br>

    <label for="cat">Sender Group:</label>
    <select name="cat" id="cat">
      {{GROUP_OPTIONS}}
    </select><br><br>

    <label for="sensor">Sensor Type:</label>
    <select name="sensor" id="sensor">
      {{SENSOR_OPTIONS}}
    </select><br><br>

    <label for="ldr">Enable LDR Sensor:</label>
    <select name="ldr" id="ldr">
      <option value="0" {{LDR_OFF}}>Disabled</option>
      <option value="1" {{LDR_ON}}>Enabled</option>
    </select><br><br>

    <input type="submit" value="Save Config">
  </form>

  <p id="timeoutWarning" style="font-weight:bold; color:red;"></p>

  <hr>
  <a href="/update.html">Firmware Update</a>

  <script>
    // Countdown timer for page shutdown
    const duration = 180;
    let remaining = duration;

    const countdown = setInterval(() => {
      const minutes = Math.floor(remaining / 60);
      const seconds = remaining % 60;
      document.getElementById("timeoutWarning").textContent =
        `This page will close in ${minutes}:${seconds < 10 ? '0' : ''}${seconds} to preserve battery.`;
      remaining--;

      if (remaining < 0) {
        clearInterval(countdown);
        document.getElementById("timeoutWarning").textContent =
          "Shutting down...";
      }
    }, 1000);

    // Auto-enable and lock LDR when SENSOR_WITTY is selected
    document.addEventListener("DOMContentLoaded", function() {
      const sensorSelect = document.getElementById("sensor");
      const ldrSelect = document.getElementById("ldr");
      const SENSOR_WITTY = 6; // adjust if enum value changes

      function updateLdrState() {
        const selected = parseInt(sensorSelect.value);
        if (selected === SENSOR_WITTY) {
          ldrSelect.value = "1";
          ldrSelect.disabled = true;
        } else {
          ldrSelect.disabled = false;
        }
      }

      sensorSelect.addEventListener("change", updateLdrState);
      updateLdrState();
    });
  </script>

</body>
</html>
